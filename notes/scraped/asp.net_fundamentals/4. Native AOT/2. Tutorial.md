# Tutorial: Publish an ASP.NET Core app using Native AOT

[.NET native ahead-of-time (AOT)](https://learn.microsoft.com/en-us/dotnet/core/deploying/native-aot/) is available in ASP.NET Core.

> [!NOTE]
> Minimal APIs are ***not*** compatible with native AOT.

See [Native AOT deployment](https://learn.microsoft.com/en-us/dotnet/core/deploying/native-aot/) for more information, including:

* [Limitations of Native AOT deployment](https://learn.microsoft.com/en-us/dotnet/core/deploying/native-aot/#limitations-of-native-aot-deployment)
* [Supported platforms](https://learn.microsoft.com/en-us/dotnet/core/deploying/native-aot/#platformarchitecture-restrictions)

## Prerequisites

* [.NET CLI](https://learn.microsoft.com/en-us/aspnet/core/#tabpanel_1_net-cli)
* [Visual Studio](https://learn.microsoft.com/en-us/aspnet/core/#tabpanel_1_visual-studio)

* [.NET SDK](https://dotnet.microsoft.com//download)
* On Linux, see [Prerequisites for Native AOT deployment](https://learn.microsoft.com/en-us/dotnet/core/deploying/native-aot/?tabs=net8plus#prerequisites-for-native-aot-deployment).
* [Visual Studio 2022](https://visualstudio.microsoft.com/downloads/) with the **Desktop development with C++** workload installed.

  ![Visual Studio workload selection dialog showing "Desktop development with C++" selected.](https://learn.microsoft.com/en-us/aspnet/core/_static/cpponly.png?view=aspnetcore-10.0)

> [!NOTE]
> Visual Studio 2022 is required because Native AOT requires [link.exe](https://learn.microsoft.com/en-us/cpp/build/reference/linker-options) and the Visual C++ static runtime libraries. There are no plans to support Native AOT ***without*** Visual Studio.

[.NET SDK](https://dotnet.microsoft.com//download)

* [Visual Studio 2022](https://visualstudio.microsoft.com/downloads/) with the following workloads installed:

  + **ASP.NET and web development**
  + **Desktop development with C++**

  ![Visual Studio workload selection dialog showing "ASP.NET and web development" and "Desktop development with C++" selected.](https://learn.microsoft.com/en-us/aspnet/core/_static/ddcpp.png?view=aspnetcore-10.0)

## Create a web app with Native AOT

Create an ASP.NET Core API app that is configured to work with Native AOT:

* [.NET CLI](https://learn.microsoft.com/en-us/aspnet/core/#tabpanel_2_net-cli)
* [Visual Studio](https://learn.microsoft.com/en-us/aspnet/core/#tabpanel_2_visual-studio)

Run the following commands:

```dotnetcli
dotnet new webapiaot -o MyFirstAotWebApi && cd MyFirstAotWebApi
```

Output similar to the following example is displayed:

```output
The template "ASP.NET Core Web API (Native AOT)" was created successfully.

Processing post-creation actions...
Restoring C:\Code\Demos\MyFirstAotWebApi\MyFirstAotWebApi.csproj:
  Determining projects to restore...
  Restored C:\Code\Demos\MyFirstAotWebApi\MyFirstAotWebApi.csproj (in 302 ms).
Restore succeeded.
```

1. Create a new  `ASP.NET Core Web API (Native AOT)`  project.
2. Name the project **MyFirstAotWebApi**.
3. Select **Create**.

## Publish the Native AOT app

Verify the app can be published using Native AOT:

* [.NET CLI](https://learn.microsoft.com/en-us/aspnet/core/#tabpanel_3_net-cli)
* [Visual Studio](https://learn.microsoft.com/en-us/aspnet/core/#tabpanel_3_visual-studio)

```dotnetcli
dotnet publish
```

Visual studio doesn't support publishing an AOT app. Use the CLI command:

```dotnetcli
dotnet publish
```

The  `dotnet publish`  command:

* Compiles the source files.
* Generates source code files that are compiled.
* Passes generated assemblies to a native IL compiler. The IL compiler produces the native executable. The native executable contains the native machine code.

Output similar to the following example is displayed:

```output
MSBuild version 17.<version> for .NET
  Determining projects to restore...
  Restored C:\Code\Demos\MyFirstAotWebApi\MyFirstAotWebApi.csproj (in 241 ms).
C:\Code\dotnet\aspnetcore\.dotnet\sdk\8.0.<version>\Sdks\Microsoft.NET.Sdk\targets\Microsoft.NET.RuntimeIde
ntifierInference.targets(287,5): message NETSDK1057: You are using a preview version of .NET. See: https://aka.ms/dotne
t-support-policy [C:\Code\Demos\MyFirstAotWebApi\MyFirstAotWebApi.csproj]
  MyFirstAotWebApi -> C:\Code\Demos\MyFirstAotWebApi\bin\Release\net8.0\win-x64\MyFirstAotWebApi.dll
  Generating native code
  MyFirstAotWebApi -> C:\Code\Demos\MyFirstAotWebApi\bin\Release\net8.0\win-x64\publish\
```

The output may differ from the preceding example depending on the version of .NET 8 used, directory used, and other factors.

Review the contents of the output directory:

```
dir bin\Release\net8.0\win-x64\publish
```

Output similar to the following example is displayed:

```Output
Directory: C:\Code\Demos\MyFirstAotWebApi\bin\Release\net8.0\win-x64\publish

Mode                 LastWriteTime         Length Name
----                 -------------         ------ ----
-a---          30/03/2023  1:41 PM        9480704 MyFirstAotWebApi.exe
-a---          30/03/2023  1:41 PM       43044864 MyFirstAotWebApi.pdb
```

The executable is self-contained and doesn't require a .NET runtime to run. When launched, it behaves the same as the app run in the  `Development`  environment. Run the AOT app:

```
.\bin\Release\net8.0\win-x64\publish\MyFirstAotWebApi.exe
```

Output similar to the following example is displayed:

```output
info: Microsoft.Hosting.Lifetime[14]
      Now listening on: http://localhost:5000
info: Microsoft.Hosting.Lifetime[0]
      Application started. Press Ctrl+C to shut down.
info: Microsoft.Hosting.Lifetime[0]
      Hosting environment: Production
info: Microsoft.Hosting.Lifetime[0]
      Content root path: C:\Code\Demos\MyFirstAotWebApi
```

### Libraries and Native AOT

Many of the popular libraries used in ASP.NET Core projects currently have some compatibility issues when used in a project targeting Native AOT, such as:

* Use of reflection to inspect and discover types.
* Conditionally loading libraries at runtime.
* Generating code on the fly to implement functionality.

Libraries using these dynamic features need to be updated in order to work with Native AOT. They can be updated using tools like Roslyn source generators.

Library authors hoping to support Native AOT are encouraged to:

* Read about [Native AOT compatibility requirements](https://learn.microsoft.com/en-us/dotnet/core/deploying/native-aot/?tabs=net8plus).
* [Prepare the library for trimming](https://learn.microsoft.com/en-us/dotnet/core/deploying/trimming/prepare-libraries-for-trimming).