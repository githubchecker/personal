# 7. Conventions

# Relationship Conventions

EF Core uses **Conventions** to automatically discover and build relationships by analyzing your entity classes. These can always be overridden by Data Annotations or the Fluent API.

## 1. Discovering Navigations

EF Core identifies a property as a navigation if it meets specific rules.

### Reference Navigations (One Side)

- **Rules:** Public property with a getter and setter (setter can be private/init). Type must be a non-primitive reference type.

```csharp
public class Blog
{
    public Author? Author { get; set; } // Discovered as reference navigation
}

```

### Collection Navigations (Many Side)

- **Rules:** Public property with a getter. Type must implement `IEnumerable<TEntity>`.

```csharp
public class Blog
{
    public ICollection<Post> Posts { get; } = new List<Post>(); // Discovered as collection navigation
}

```

## 2. Pairing and Cardinality

EF Core "pairs" navigations in opposite directions to form a relationship.

- **One-to-Many:** One `Collection` navigation paired with one `Reference` navigation.
- **One-to-One:** Two `Reference` navigations paired together.
- **Many-to-Many:** Two `Collection` navigations paired together.

## 3. Foreign Key Naming Conventions

Once navigations are found, EF looks for properties that match any of these patterns (case-insensitive):

- `<NavigationName><PrincipalKeyName>` (e.g., `BlogId`)
- `<NavigationName>Id` (e.g., `TheBlogId`)
- `<PrincipalEntityName><PrincipalKeyName>` (e.g., `BlogKey`)
- `<PrincipalEntityName>Id` (e.g., `BlogId`)

If no matching property is found, EF Core creates a **Shadow Foreign Key**.

## 4. Default Behaviors

### Cascade Delete

- **Required Relationship:** Configured for **Cascade Delete** by default.
- **Optional Relationship:** Configured for **ClientSetNull** (no database-level cascade) by default.

### Database Indexes

EF Core automatically creates indexes for Foreign Key columns:

- **One-to-Many:** Non-unique index.
- **One-to-One:** Unique index (filtered with `IS NOT NULL` on SQL Server for optional relationships).

### Many-to-Many

- **Join Table Name:** `<LeftEntity><RightEntity>` (alphabetical or based on configuration order).
- **Join Entity Columns:** `<LeftEntity>Id` and `<RightEntity>Id`.
- **Primary Key:** Composite key of both Foreign Keys.

## 5. Customizing Conventions

You can remove default conventions (e.g., automatic index creation) in `ConfigureConventions`:

```csharp
protected override void ConfigureConventions(ModelConfigurationBuilder configurationBuilder)
{
    configurationBuilder.Conventions.Remove(typeof(ForeignKeyIndexConvention));
}

```