# 1. Overview

# Scaffolding (Reverse Engineering)

**Reverse Engineering** is the process of generating entity classes and a `DbContext` based on an existing database schema.

## 1. Prerequisites

- **Tools:** Install .NET CLI (`dotnet-ef`) or Package Manager Console tools.
- **Packages:** Install `Microsoft.EntityFrameworkCore.Design` and your provider (e.g., `Microsoft.EntityFrameworkCore.SqlServer`) in the target project.

## 2. Basic Commands

The two required arguments are the **Connection String** and the **Provider Name**.

### .NET CLI

```bash
dotnet ef dbcontext scaffold "CONNECTION_STRING" Microsoft.EntityFrameworkCore.SqlServer

```

### PMC (Visual Studio)

```powershell
Scaffold-DbContext 'CONNECTION_STRING' Microsoft.EntityFrameworkCore.SqlServer

```

## 3. Common Options

| Option | Purpose |
| --- | --- |
| `--table` | Scaffold specific tables only (can be specified multiple times). |
| `--schema` | Scaffold all tables in a specific schema. |
| `--data-annotations` | Use attributes (`[Key]`, `[Required]`) instead of Fluent API where possible. |
| `--use-database-names` | Preserve original database table/column names exactly. |
| `--context` | Set a custom name for the generated `DbContext`. |
| `--output-dir` | Directory for entity classes. |
| `--context-dir` | Separate directory for the `DbContext` class. |
| `--force` | Overwrite existing files (dangerous if manual changes were made). |

## 4. Managing Scaffolded Code

### Strategy A: Scaffold Once

Generate the code once and then treat it as a **Code-First** project. Evolve the model using Migrations and stop re-running the scaffold command.

### Strategy B: Repeated Scaffolding

Re-run scaffolding whenever the database schema changes. To avoid losing custom logic:

- **Partial Classes:** Entity and Context classes are generated as `partial`. Add your own logic (methods, extra properties) in separate files.
- `OnModelCreatingPartial`**:** Use this partial method in your context file to add custom configuration that isn't overwritten.
- **T4 Templates:** (EF 7+) Distribute `.t4` files in your project to customize how the scaffolded code is formatted and generated.

## 5. Limitations

Scaffolding reads the physical schema, which lacks high-level EF Core concepts:

- **Inheritance:** Hierarchies (TPH/TPT) are seen as flat tables or sets of tables.
- **Owned Types:** Are seen as regular entities or split columns.
- **Table Splitting:** Multiple entities sharing a table are detected as a single entity.
- **Shadow Properties:** Cannot be discovered from a database schema.
- **Unmapped Logic:** Complex types or value converters must be added manually after scaffolding.