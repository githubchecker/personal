# 50. Seed Data in Entity Framework Core

# Data Seeding in EF Core

**Data Seeding** is the process of populating a database with an initial set of data. This is essential for setting up master data (like countries or roles), default configuration settings, or initial administrative accounts during deployment.

---

### 1. Seeding via Migrations (`HasData`)

The standard approach is using the `HasData()` method within `OnModelCreating`. This data is embedded into your migration files and applied to the database when you run `Update-Database`.

```csharp
protected override void OnModelCreating(ModelBuilder modelBuilder)
{
    modelBuilder.Entity<Currency>().HasData(
        new Currency { Id = 1, Name = "US Dollar", Code = "USD" },
        new Currency { Id = 2, Name = "Indian Rupee", Code = "INR" }
    );
}
```

**Important Rules for Migration Seeding:**
* **Manual Primary Keys:** You **must** provide values for primary key columns, even if they are marked as `Identity` or `Auto-increment`.
* **Change Tracking:** If you modify the properties of an object inside `HasData`, the next migration will generate an `UPDATE` statement. If you remove the object, a `DELETE` statement is generated.

---

### 2. Runtime Seeding (Custom Logic)

For more complex scenarios—such as seeding data from a JSON file, using complex logic, or requiring database-generated IDs—you should implement a manual seating method called during application startup.

```csharp
public static class DbInitializer
{
    public static void Seed(MyDbContext context)
    {
        // Check if the database has already been seeded
        if (context.Products.Any()) return;

        var products = new List<Product>
        {
            new Product { Name = "Standard Membership", Price = 19.99m },
            new Product { Name = "Premium Membership", Price = 49.99m }
        };

        context.Products.AddRange(products);
        context.SaveChanges();
    }
}
```

---

### Comparison: `HasData` vs. Runtime Seeding

| Feature | `HasData` (Migrations) | Runtime Seeding |
| --- | --- | --- |
| **Execution** | Part of the `Apply-Migration` step. | During application startup (Program.cs). |
| **Complexity** | Visual/Static values only. | Can include complex logic and loops. |
| **IDs** | Must be manually assigned. | Can be auto-generated by the database. |
| **Best For** | Stable system data (Roles, Statuses). | Test data or environment-specific info. |

---

### Best Practices

1. **Keep Context Clean:** For large datasets, move `HasData` calls into separate configuration classes using `IEntityTypeConfiguration<T>`.
2. **Environment Isolation:** Use runtime seeding to populate “Dummy Data” only in `Development` environments. Never seed test data into production.
3. **Idempotency:** Always check if records exist (`.Any()`) before seeding at runtime to prevent duplicate key exceptions.
4. **Security:** Never hardcode passwords or API keys in seeding logic. Use environment variables or a secret manager to fetch sensitive values during the seeding process.