# Identity

Of course. Mastering the different sign-on methods is like understanding the different types of keys and security checks for a building. It's fundamental to everything else.

Let's use our office building analogy to make this crystal clear and build you into an expert.

In this analogy:

- **Your company's on-premises Active Directory (AD)** is your local, main office branch security desk. It's been there for years.
- **Azure Active Directory (Azure AD)** is the new, global headquarters security system, located in the cloud. It needs to know about all your employees.

The central question is: **When an employee tries to access an app, which security desk checks their ID badge (credentials)?**

There are three primary ways this happens.

---

# **Category 1: The Basic Sign-On (Cloud-Managed Identity)**

This is the simplest method. The employee's identity is created and managed directly at the global headquarters.

- **What is it?**
    - The user has an account (e.g., `jane@mycompany.onmicrosoft.com`) that exists *only* in Azure AD. Azure AD stores a secure hash of the user's password and is solely responsible for validating it.
- **The Analogy:**
    - The employee, Jane, was hired to work at the global headquarters directly. She has no record at any local office branch. When she shows her ID badge, the global HQ security desk is the only one that can verify it.
- **When to Use It:**
    - **Cloud-only organizations:** New companies or startups that don't have a traditional on-premises AD.
    - **External users/guests:** When you invite a contractor or partner to collaborate.
    - **Specific cloud admin accounts:** For emergency access to Azure that doesn't depend on your on-premises infrastructure.
- **How it Works:**
    - The user goes to a login page, types in their username and password, and Azure AD validates it against its own database.
- **Azure AD Configuration:**
    1. This is the default behavior. Simply go to the Azure AD portal.
    2. Navigate to **Users -> New user**.
    3. Create a user. Their identity is now cloud-managed. No complex configuration is needed.

---

# **Category 2: The Seamless Sign-On (SSO with a Hybrid Identity)**

This is the most common and desired experience for organizations that have an existing on-premises AD. The goal is "Single Sign-On" (SSO) — log in once to your work computer and access everything without re-entering your password.

- **What is it?**
    - The user has an account in the on-premises AD that is synchronized to Azure AD. When they sign in, the experience is seamless and often automatic.
- **The Analogy:**
    - Your local office branch security desk (On-prem AD) has a high-tech, secure link to the global HQ security system (Azure AD). When an employee joins the local office, their details are automatically and securely sent to the global HQ.
- **How is this achieved?**
    - There are two primary methods, configured using a tool called **Azure AD Connect**.

### **Method 2A: Password Hash Synchronization (PHS) + Seamless SSO (Most Popular)**

- **What is it?**
    - The on-premises AD securely synchronizes a hash of the user's password hash up to Azure AD. When the user logs into a cloud app, Azure AD can validate their password itself, without having to contact the on-premises AD.
- **The Analogy:**
    - The local office security desk sends a heavily encrypted, un-reversable fingerprint scan (the hash) of the employee's ID badge to the global HQ. Now, the global HQ can verify the employee's badge without having to call the local office. It's fast and efficient.
- **When to Use It:**
    - This is the **recommended and most common method** for hybrid identity. It's simple, resilient, and provides the best user experience.
- **Azure AD Configuration:**
    1. Install **Azure AD Connect** on a server in your on-premises environment.
    2. During the setup wizard, select **Password Hash Synchronization** as the sign-on method.
    3. Crucially, check the box for **Enable single sign-on**. This will configure the "Seamless SSO" part, which uses technologies like Kerberos on your internal network to automatically sign users in.

### **Method 2B: Pass-through Authentication (PTA) + Seamless SSO**

- **What is it?**
    - The user's identity is synced to Azure AD, but their password hash is **not**. When a user tries to sign in, Azure AD "passes through" the validation request to a small agent running on-premises, which checks the password against the local AD.
- **The Analogy:**
    - The global HQ security desk receives an ID badge. Instead of checking it themselves, they have a live, secure video feed to the local office security desk. They show the badge to the camera and ask, "Is this person valid?" The local desk gives a thumbs-up or thumbs-down.
- **When to Use It:**
    - For organizations with a strict corporate security policy that forbids password hashes (even securely hashed ones) from being stored in the cloud.
- **Azure AD Configuration:**
    1. Install **Azure AD Connect**.
    2. During setup, select **Pass-through Authentication** as the sign-on method.
    3. You will also be prompted to install the PTA agent on one or more on-premises servers (domain controllers are common).
    4. You would also enable the "**Enable single sign-on**" checkbox for the seamless experience.

---

# **Category 3: The Federated Sign-On (Federation)**

This is the most complex method, where you delegate the entire authentication process to another trusted system.

- **What is it?**
    - Azure AD is configured to **trust** another identity provider completely. When a user tries to sign in, Azure AD immediately redirects them to that other system to handle the sign-in. Once authenticated, the other system sends the user back with a secure token that says, "This user is legitimate."
- **The Analogy:**
    - Your global HQ has a strategic partnership with another company, "Trusted Security Inc." You configure your global security desk (Azure AD) so that if anyone with a "Trusted Security Inc." ID badge shows up, you don't even try to check their details. You just send them over to the "Trusted Security Inc." building to get validated. If they come back with a special signed pass, you let them in. You have **federated** your trust to them.
- **When to Use It:**
    - Organizations that have already invested heavily in an on-premises federation service, most commonly **Active Directory Federation Services (ADFS)**.
    - Complex security requirements that cannot be met by PHS or PTA.
    - Some multi-national B2B scenarios where you trust another organization's identity system.
- **Azure AD Configuration:**
    1. This is the most involved setup. You do **not** sync password hashes.
    2. In Azure AD Connect, you choose the **Federation with AD FS** option.
    3. This involves setting up a "trust relationship" by exchanging security certificates and metadata between your ADFS servers and Azure AD.
    4. Your ADFS servers become a critical part of your sign-in infrastructure. If they go down, no one can log in to cloud apps.

---

# **Summary Table for the Expert**

| Sign-On Method | Analogy | How it Works | When to Use It | Azure AD Config |
| --- | --- | --- | --- | --- |
| **Cloud-Managed** | Employee hired directly at Global HQ. | Password hash is stored and validated only in Azure AD. | Cloud-only orgs, guests, special admin accounts. | Create user directly in Azure AD portal. |
| **PHS + Seamless SSO** | Local office securely sends a fingerprint scan (hash) to HQ. | Password hashes are synced to Azure AD. Azure AD validates sign-ins. Seamless SSO handles auto-login on the corporate network. | **The default, recommended choice** for most hybrid organizations. | Azure AD Connect: Select **PHS** and **Enable SSO**. |
| **PTA + Seamless SSO** | HQ uses a live video feed to ask the local office if the user is valid. | Authentication is delegated back to an on-prem agent. No password hashes in the cloud. Seamless SSO provides the auto-login. | For orgs with strict policies against storing hashes in the cloud. | Azure AD Connect: Select **PTA** and **Enable SSO**. |
| **Federation (e.g., ADFS)** | HQ trusts another company ("Trusted Security Inc.") to handle all validations. | Azure AD redirects the user to the federated system (ADFS) to sign in. ADFS sends back a security token. | Organizations with existing ADFS deployments or very complex security needs. | Azure AD Connect: Select **Federation with AD FS**. Requires complex trust setup. |

By understanding these three categories—Cloud-Managed, Hybrid SSO, and Federated—you'll be able to analyze any sign-on scenario and determine the right technology to apply. For AZ-204, focusing on PHS and PTA is especially important as they are the most common modern solutions.